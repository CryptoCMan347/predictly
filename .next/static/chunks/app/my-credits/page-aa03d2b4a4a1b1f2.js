(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[767],{5889:function(e,t,s){Promise.resolve().then(s.bind(s,4904))},4904:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return r}});var a=s(7437),n=s(2265),i=s(605);function r(){var e;let{data:t,status:s}=(0,i.useSession)(),[r,l]=(0,n.useState)(!1),[c,o]=(0,n.useState)(""),[d,u]=(0,n.useState)(!1),[x,m]=(0,n.useState)(""),[h,g]=(0,n.useState)(""),[f,b]=(0,n.useState)([]),[N,p]=(0,n.useState)(!1),[y,j]=(0,n.useState)(""),v=c&&!isNaN(Number(c))?(Number(c)/10).toFixed(2):"0.00";(0,n.useEffect)(()=>{(null==t?void 0:t.user)&&w()},[null==t?void 0:t.user]);let w=async()=>{p(!0),j("");try{let e=await fetch("/api/transactions"),t=await e.json();e.ok&&t.transactions?b(t.transactions):j(t.error||"Failed to fetch transactions.")}catch(e){j("Failed to fetch transactions.")}finally{p(!1)}},k=async()=>{var e;if(null==t?void 0:null===(e=t.user)||void 0===e?void 0:e.id)return t.user.id;try{let e=await fetch("/api/account"),t=await e.json();if(e.ok&&t.user&&t.user.id)return t.user.id}catch(e){}},C=async()=>{console.log("session.user",null==t?void 0:t.user),g("");let e=Number(c);if(!c||isNaN(e)||e<50){g("Minimum purchase is ".concat(50," credits."));return}u(!0),m("");try{let t=await k();if(!t){m("Could not determine user ID. Please sign in again."),u(!1);return}let s=await fetch("/api/stripe/checkout",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({credits:e,userId:t})}),a=await s.json();s.ok&&a.url?window.location.href=a.url:m(a.error||"Failed to start checkout.")}catch(e){m("Failed to start checkout.")}finally{u(!1)}};return"loading"===s?(0,a.jsx)("div",{children:"Loading..."}):(null==t?void 0:t.user)?(0,a.jsxs)("main",{className:"min-h-screen bg-black text-white py-8 px-4 animate-fade-in",children:[(0,a.jsxs)("div",{className:"max-w-md mx-auto bg-gray-900 rounded-lg shadow p-8",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold mb-6 text-center",children:"My Credits"}),(0,a.jsxs)("div",{className:"mb-8 text-center",children:[(0,a.jsx)("span",{className:"text-lg text-gray-300",children:"Current Balance:"}),(0,a.jsx)("span",{className:"text-4xl font-extrabold text-green-400 ml-2",children:null!==(e=t.user.credits)&&void 0!==e?e:0})]}),(0,a.jsx)("button",{onClick:()=>{o(""),g(""),m(""),l(!0)},className:"w-full bg-green-500 hover:bg-green-400 text-black font-bold py-3 px-4 rounded-full text-lg shadow transition-all duration-200 focus:outline-none focus:ring-4 focus:ring-green-300 mb-2",children:"Buy Credits"})]}),r&&(0,a.jsx)("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-60 z-50",children:(0,a.jsxs)("div",{className:"bg-gray-900 rounded-lg shadow-lg p-8 w-full max-w-sm relative",children:[(0,a.jsx)("button",{onClick:()=>{l(!1),g(""),m("")},className:"absolute top-2 right-2 text-gray-400 hover:text-red-400 text-2xl font-bold focus:outline-none","aria-label":"Close",children:"\xd7"}),(0,a.jsx)("h2",{className:"text-2xl font-bold mb-4 text-center",children:"Buy Credits"}),(0,a.jsx)("label",{htmlFor:"credits",className:"block mb-2 text-gray-300 font-semibold",children:"Number of Credits"}),(0,a.jsx)("input",{id:"credits",type:"text",inputMode:"numeric",pattern:"[0-9]*",min:50,value:c,onChange:e=>{let t=e.target.value;""===t?(o(""),g("")):/^\d+$/.test(t)&&(o(t),50>Number(t)?g("Minimum purchase is ".concat(50," credits.")):g(""))},placeholder:"Enter number of credits",className:"w-full mb-2 p-2 rounded bg-gray-800 text-white focus:outline-none focus:ring-2 focus:ring-green-400 ".concat(h?"border border-red-400":""),autoFocus:!0}),(0,a.jsxs)("div",{className:"mb-2 text-gray-400 text-sm",children:["Minimum purchase: ",50," credits"]}),(0,a.jsxs)("div",{className:"mb-4 text-green-300 text-lg",children:["Total: ",(0,a.jsxs)("span",{className:"font-bold",children:["$",v]})]}),(0,a.jsx)("button",{onClick:C,disabled:d||!!h,className:"w-full bg-green-500 hover:bg-green-400 text-black font-bold py-2 px-4 rounded-full text-lg shadow transition-all duration-200 focus:outline-none focus:ring-4 focus:ring-green-300 disabled:opacity-60",children:d?"Redirecting to Stripe...":"Proceed to Checkout"}),h?(0,a.jsx)("div",{className:"text-red-400 mt-2 text-sm",children:h}):x?(0,a.jsx)("div",{className:"text-red-400 mt-2 text-sm",children:x}):null]})}),(0,a.jsxs)("div",{className:"max-w-md mx-auto bg-gray-900 rounded-lg shadow p-8 mt-8",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold mb-4 text-center",children:"Transaction History"}),N?(0,a.jsx)("div",{children:"Loading..."}):y?(0,a.jsx)("div",{className:"text-red-400",children:y}):0===f.length?(0,a.jsx)("div",{className:"text-gray-400",children:"No transactions yet."}):(0,a.jsx)("ul",{children:f.map(e=>(0,a.jsxs)("li",{className:"mb-3 bg-gray-800 rounded p-3 flex flex-col md:flex-row md:items-center md:justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"font-mono text-green-300",children:["+",e.credits," credits"]}),(0,a.jsxs)("div",{className:"text-gray-400 text-xs",children:["$",e.amount.toFixed(2)," via ",e.paymentType," (",e.status,")"]})]}),(0,a.jsx)("div",{className:"text-gray-400 text-xs mt-1 md:mt-0",children:new Date(e.createdAt).toLocaleString()})]},e.id))})]})]}):(0,a.jsx)("div",{children:"Please sign in to view your credits."})}}},function(e){e.O(0,[605,971,117,744],function(){return e(e.s=5889)}),_N_E=e.O()}]);